<!DOCTYPE html>
<html lang="ja">
    <head>
        <meta charset="UTF-8">
        <title>北向いてる？</title>
        <style>
            body {text-align: center; padding: 50px; font-family: sans-serif;}
            #angle {font-size: 80px; margin: 20px;}
            .success {background-color: gold;}
        </style>
    </head>
    <body>
        <h1>北(0°)を向け！</h1>
        <div id="angle">---°</div>
        <p id="msg">スマホで開いて、下のボタンを押してね</p>
        <button id="start-btn"  style="padding: 10px 20px;">計測開始</button>

        <script>
            let currentHeading = 0;

            window.addEventListener('deviceorientation', (event) => {
                currentHeading = event.webkitCompassHeading || (360 - event.alpha);
            }, true);

            const angleDisplay = document.getElementById('angle');
            const msgDisplay = document.getElementById('msg');
            const btn = document.getElementById('start-btn');

            btn.addEventListener('click', async () => {
                if(typeof DeviceOrientationEvent.requestPermission === 'function'){
                    const permission = await DeviceOrientationEvent.requestPermission();
                    if(permission !== 'granted') return;
                }

                let rounded = Math.round(currentHeading);
                if(rounded === 360) rounded = 0;

                angleDisplay.innerText = rounded + "° ";

                if(rounded === 0){
                    document.body.classList.add('success');
                    msgDisplay.innerText = "ぴったり！北です！";
                }else{
                    document.body.classList.remove('success');
                    msgDisplay.innerText = "北じゃないよ！";
                }

                btn.innerText = "もう一度計測する";
            });
        </script>
    </body>
</html>

<h1>北を向いているか？</h1>
<div id="status">ここに角度が出ます</div>
<button id="btn">計測スタート</button> 
